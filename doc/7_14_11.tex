\documentclass[letter,10pt]{article}

\usepackage{ulem}
\usepackage{verbatim}
%\linespread{1.6}  % double spaces lines
\usepackage[left=1in,top=1in,right=1in,bottom=1in,nohead]{geometry}

\usepackage{amsfonts, amsmath, amssymb, graphics}
\usepackage[pdftex]{graphicx}

%\usepackage{mathpazo}
\usepackage{flexisym}
\usepackage{breqn}
\usepackage{url}

\newcommand{\mathsym}[1]{{}}
\newcommand{\unicode}[1]{{}}

\input{macros.tex}
\input{misc_mac.tex}




\title{7/14/11 Update}
\author{Evan Bollig}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle

\tableofcontents
%\section{}
%\subsection{}

\section{Starting Point} 

Given the following equation defined on the sphere: 
\begin{equation*} 
h(\theta, \phi) = 1-\text{Tanh}\left[\frac{\rho_{0} \text{Cos}[\theta] \text{Sin}\left[\phi-\frac{3 \sqrt{3} t \text{Sec}[\theta] \text{Sech}[\rho_{0} \text{Cos}[\theta]]^2 \text{Tanh}[\rho_{0} \text{Cos}[\theta]]}{2 \rho_{0}}\right]}{\gamma}\right]
\end{equation*} 
where $\theta$ is latitude and $\phi$ is longitude, we seek the $\Delta_{sfc} h$ (the laplacian of $h$ defined over the sphere). 

Initial scripts were provided: \verb|Calc_Lsfc_fd.m| and \verb|Lsfc_test.m|. The first calculated RBF-FD weights and forms a differentiation matrix to approximate the laplacian; the latter applies the weights and interpolates approximate and exact results to the sphere for plotting. In Figure~\ref{fig:initial_t=3} we see the results generated by \verb|Lsfc_test.m| for $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. Note that we are looking at the sphere along the negative Z-axis (i.e., we see the X-Y plane).

\begin{figure}[h]
\begin{center}
\includegraphics[width=3in]{../Figures/initial_t=3.png}
\caption{Initial approximation to $\Delta_{s} h(\theta,\phi,t)$ at $t=3$ (on left), and the exact Laplacian (on right)}
\label{fig:initial_t=3}
\end{center}
\end{figure}
\clearpage

\section{Adding Variable Time}

While reviewing the code I realized that the exact solution we specified for the laplacian was not time dependent. To 
add this, I re-derived the laplacian of $h$ using the Mathematica code in Appendix~\ref{app:VortexRollup.nb}. The resulting FortranForm code was converted to Matlab syntax in Appendix~\ref{app:Lsfc_h_evan.m}. 

In Figure~\ref{fig:initial_t=0}, I have adjusted the time to $t=0$. 

\begin{figure}[h]
\begin{center}
\includegraphics[width=3in]{../Figures/initial_t=0.png}
\caption{Initial approximation to $\Delta_{s} h(\theta,\phi,t)$ at $t=0$ (on left), and the exact Laplacian (on right)}
\label{fig:initial_t=0}
\end{center}
\end{figure}

\section{Verifying the Code}

Looking at Figure~\ref{fig:initial_t=0} I had doubts that the laplacian we calculated was correct. At $t=0$, the solution $h$ is a linear gradient from the north pole down to the south pole. With the laplacian in Figure~\ref{fig:initial_t=0}, the solution would be very different. 

To help verify the code, I therefore reverted to interpolating the exact solution of $h$ to the sphere as shown in Figure~\ref{fig:initial_h_at_t=3}. Clearly, Figure~\ref{fig:initial_h_at_t=3} does not properly recreate the expected solution. 

\begin{figure}[h]
\begin{center} 
\includegraphics[width=3in]{../Figures/initial_h_at_t=3.png}
\caption{Initial interpolation of $h(\theta,\phi,t)$ at $t=3$.}
\label{fig:initial_h_at_t=3}
\end{center}
\end{figure}

After thoroughly reviewing both Matlab scripts and making significant changes related to how data was interpolated to the sphere, 
I  ended up with the \verb|Interp_h_test.m| script in Appendix~\ref{app:Interp_h_test.m}. The results of this script shown in 
Figure~\ref{fig:correct_h_at_t=3} the solution of $h(\theta, \phi, t)$ interpolated to the sphere using global RBF interpolation with the input 
MD nodes as the trial nodes (i.e., RBF samples and centers for matrix $A$), and the uniform sampling of the sphere for
 $\theta$ and $\phi$ as the test nodes (i.e., samples for matrix $B$). Double checking the result of our interpolation at $t=0$, we get Figure~\ref{fig:correct_h_at_t=0}. 

\begin{figure}[h]
\begin{center} 
\includegraphics[width=5in]{../Figures/Interp_h_test_eps8p5_N2601_th20phi20_t3.png}
\caption{Correct interpolation of $h(\theta,\phi,t)$ at $t=3$. Interpolation support parameter, $\epsilon_{i}=8.5$. $N=2601$ trial points, $N_{\theta} = N_{\phi} = 20$ test points. }
\label{fig:correct_h_at_t=3}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center} 
\includegraphics[width=5in]{../Figures/Interp_h_test_eps8p5_N2601_th20phi20_t0.png}
\caption{Correct interpolation of $h(\theta,\phi,t)$ at $t=0$. Interpolation support parameter, $\epsilon_{i}=8.5$. $N=2601$ trial points, $N_{\theta} = N_{\phi} = 20$ test points. }
\label{fig:correct_h_at_t=0}
\end{center}
\end{figure}

With the interpolation working properly, I returned to \verb|Lsfc_test.m| shown in Appendix~\ref{app:Lsfc_test.m} to use RBF-FD to correctly approximate the $\Delta_{s} h(\theta,\phi,t)$, and then independently apply a global RBF interpolation to draw the solution on the sphere consistent with the method for Figures~\ref{fig:correct_h_at_t=3} and \ref{fig:correct_h_at_t=0}. In Figure~\ref{fig:eps8.5_Lsfc_at_t=3} we see that our approximation to $\Delta_{s} h(\theta,\phi,t)$ is reasonably good. However, look closely at Figure~\ref{fig:eps8.5_Lsfc_at_t=0} where we switch $t=0$ to test the laplacian when $h(\theta,\phi,t)$ is very smooth---the approximation is very poor. Note the relative error is colored according to the range $[0,max(1, max(rel\_err))]$, so any relative error greater than 1 is colored dark red.

\begin{figure}[h]
\begin{center}
\includegraphics[width=5.5in]{../Figures/Lsfc_h_N2601_n17_eps8p5_t=3.png}
\caption{Correct approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=8.5$. $N=2601$ trial points. }
\label{fig:eps8.5_Lsfc_at_t=3}
\end{center}
\end{figure}


\begin{figure}[h]
\begin{center}
\includegraphics[width=5.5in]{../Figures/Lsfc_h_N2601_n17_eps8p5_t=0.png}
\caption{Correct approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=0$. RBF-FD support parameter, $\epsilon_{i}=8.5$. $N=2601$ trial points. }
\label{fig:eps8.5_Lsfc_at_t=0}
\end{center}
\end{figure}

To improve the approximation of $\Delta_{s} h(\theta,\phi,t)$, we change the support paramter for the RBF-FD weights to $\epsilon=2.5$ (keeping $\epsilon_{i} = 8.5$ for interpolating to the sphere). The results shown in Figure~\ref{fig:eps2.5_Lsfc_at_t=0} reveal considerable improvement at $t=0$. Figure~\ref{fig:eps2.5_Lsfc_at_t=3} verifies that the accuracy of our solution is not limited to $t=0$ by testing $t=3$. 

\begin{figure}[h]
\begin{center}
\includegraphics[width=5.5in]{../Figures/Lsfc_h_N2601_n17_eps2p5_t=0.png}
\caption{Improved approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=0$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $N=2601$ trial points. }
\label{fig:eps2.5_Lsfc_at_t=0}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=5.5in]{../Figures/Lsfc_h_N2601_n17_eps2p5_t=3.png}
\caption{Improved approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $N=2601$ trial points. }
\label{fig:eps2.5_Lsfc_at_t=3}
\end{center}
\end{figure}

\clearpage

\section{Varying Stencil Size}

In an attempt to improve accuracy of the laplacian approximation, I kept the value of $\epsilon=2.5$ constant and varied the stencil size $n=17$. Figures~\ref{fig:eps2.5_Lsfc_n=9} and \ref{fig:eps2.5_Lsfc_n=33} show the results for $n=9$ and $n=33$ respectively. Stencil size $n=33$ does well to approximate the laplacian, but we note that the relative error is still as high as 70\% at some nodes.  

\begin{figure}[h]
\begin{center}
\includegraphics[width=5in]{../Figures/Lsfc_h_N2601_n9_eps2p5_t=3.png}
\caption{$n=9$ approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $N=2601$ trial points. }
\label{fig:eps2.5_Lsfc_n=9}
\includegraphics[width=5in]{../Figures/Lsfc_h_N2601_n33_eps2p5_t=3.png}
\caption{$n=33$ approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $N=2601$ trial points. }
\label{fig:eps2.5_Lsfc_n=33}
\end{center}
\end{figure}


\clearpage

\section{Varying $N$} 

To get an idea of convergence with the total number of nodes $N$, Figures~\ref{fig:eps2.5_Lsfc_N=3364},~\ref{fig:eps2.5_Lsfc_N=4096} and \ref{fig:eps2.5_Lsfc_N=6400} show the cases when $N=3364$, $4096$ and $6400$ respectively. In both cases, $t=3$, $\epsilon=2.5$ and stencil size $n=33$.  

\begin{figure}[h]
\begin{center}
%\includegraphics[width=5in]{../Figures/Lsfc_h_N400_n33_eps2p5_t=3.png}
%\caption{$N=400$ approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $n=33$ stencil points. }
%\label{fig:eps2.5_Lsfc_N=400}
\includegraphics[width=5in]{../Figures/Lsfc_h_N3364_n33_eps2p5_t=3.png}
\caption{$N=3364$ approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $n=33$ stencil points. }
\label{fig:eps2.5_Lsfc_N=3364}
\includegraphics[width=5in]{../Figures/Lsfc_h_N4096_n33_eps2p5_t=3.png}
\caption{$N=4096$ approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $n=33$ stencil points. }
\label{fig:eps2.5_Lsfc_N=4096}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=5in]{../Figures/Lsfc_h_N6400_n33_eps2p5_t=3.png}
\caption{$N=6400$ approximation of $\Delta_{s} h(\theta,\phi,t)$ at $t=3$. RBF-FD support parameter, $\epsilon_{i}=2.5$. $n=33$ stencil points. }
\label{fig:eps2.5_Lsfc_N=6400}
\end{center}
\end{figure}

\clearpage

\section{Next Steps}
Now that we have results to compare against in Matlab, I am working on the C++ equivalent in my code to approximate $\Delta_{s} h(\theta,\phi,t)$ with similar accuracy. Beyond that, I want to timestep the solution using RK4 and generate a movie with $t=[0,10]$. 

I already have the approximation to $\d{h}{t} = - \frac{\omega(\theta) }{ cos(\theta)}\d{h}{\lambda}$ working in my code to approximate the vortex coil in time. With this new $\Delta_{s} h(\theta,\phi,t)$ operator I can keep $t$ as a constant parameter to $h$ and simulate a diffusive term to decay the coil in time. Then, I can join advection and diffusion parts into one equation. 

\clearpage

\appendix

\section{Interp\_h\_test.m}
\label{app:Interp_h_test.m}
\inputmcode{../matlab/vortex_roll_with_diffusion/Interp_h_test.m}
\clearpage

\section{Lsfc\_test.m}
\label{app:Lsfc_test.m}
\inputmcode{../matlab/vortex_roll_with_diffusion/Lsfc_test.m}
\clearpage

\section{VortexRollup.nb}
\label{app:VortexRollup.nb}
\input{vortex_appendix.tex}
\clearpage

\section{Lsfc\_h\_evan.m}
\label{app:Lsfc_h_evan.m}
\inputmcode{../matlab/vortex_roll_with_diffusion/Lsfc_h_evan.m}
\clearpage

\end{document}  